---
title: "Integrate MinIO Object Storage for Assets"
---

This guide demonstrates how to configure Vendure to use MinIO, a self-hosted S3-compatible object storage system, for storing and serving assets like product images and documents. By the end of this guide, you'll have a production-ready asset storage solution that provides scalable, distributed file storage.

:::info
This guide is based on the [minio-s3-storage](https://github.com/vendure-ecommerce/examples/tree/master/examples/minio-s3-storage) example. 
Refer to the complete working code for full implementation details.
:::

## Prerequisites

- Basic knowledge of Vendure configuration
- Docker installed for running MinIO locally
- Node.js 18+ and npm/yarn package manager
- Understanding of S3-compatible storage concepts

## Why MinIO for Asset Storage

MinIO offers several advantages over local file storage:

- **Scalability**: Handle thousands of assets without filesystem limitations
- **Performance**: Distributed architecture with high-performance object access
- **S3 Compatibility**: Drop-in replacement for AWS S3 with familiar APIs
- **Self-Hosted**: Full control over your data and infrastructure costs
- **Production Ready**: Enterprise-grade features like versioning and replication

## Installation

First, install the required AWS SDK v3 packages that enable S3-compatible storage:

```bash
npm install @aws-sdk/client-s3 @aws-sdk/lib-storage
```

:::note
Vendure uses AWS SDK v3 for S3 storage. The legacy `aws-sdk` package is not supported.
:::

## MinIO Server Setup

### Development Setup with Docker

The quickest way to run MinIO locally is using Docker:

```bash
# Run MinIO server with default credentials
docker run -d -p 9000:9000 -p 9090:9090 --name vendure-minio \
  -e "MINIO_ACCESS_KEY=minioadmin" \
  -e "MINIO_SECRET_KEY=minioadmin" \
  -v minio-data:/data \
  minio/minio server /data --console-address ":9090"
```

### Production Deployment

1. **Download MinIO Binary**
   - Go to [MinIO Download Page](https://min.io/download)
   - Choose your operating system and follow installation instructions

2. **Configure Production Environment**
   ```bash
   # Set strong credentials (required for production)
   export MINIO_ACCESS_KEY=your-secure-access-key
   export MINIO_SECRET_KEY=your-secure-secret-key-min-32-chars
   
   # Start MinIO server
   minio server /path/to/data --console-address ":9090"
   ```

3. **Security Considerations**
   - Use HTTPS endpoints in production
   - Configure firewall rules to restrict access
   - Set up proper access policies for buckets
   - Enable server-side encryption if required

### Bucket Configuration

MinIO requires bucket setup with public read permissions for asset serving:

1. **Access MinIO Console**
   - Navigate to `http://localhost:9090` (development) or your production URL
   - Login with your MinIO credentials

2. **Create Assets Bucket**
   - Click "Create Bucket"
   - Name it `vendure-assets` (or your preferred name)
   - Leave other settings as default

3. **Set Public Read Policy** ⚠️ **CRITICAL STEP**
   - Go to the bucket → "Access Rules" tab
   - Add a new policy:
   
   ```json
   {
     "Version": "2012-10-17",
     "Statement": [
       {
         "Effect": "Allow",
         "Principal": {"AWS": "*"},
         "Action": "s3:GetObject",
         "Resource": "arn:aws:s3:::vendure-assets/*"
       }
     ]
   }
   ```

:::warning
Without public read access, browsers cannot load asset images, resulting in 403 Forbidden errors.
:::

## Environment Configuration

Create a `.env` file in your Vendure project root:

```bash title=".env"
# MinIO Configuration (Primary Storage)
MINIO_ENDPOINT=http://localhost:9000
MINIO_ACCESS_KEY=minioadmin
MINIO_SECRET_KEY=minioadmin
MINIO_BUCKET=vendure-assets
MINIO_REGION=us-east-1

# Development/Testing Options
# Set to true ONLY for development/testing to use local file storage instead of MinIO
ENABLE_LOCAL_FALLBACK=false

# Basic Vendure Configuration
APP_ENV=dev
PORT=3000
SUPERADMIN_USERNAME=superadmin
SUPERADMIN_PASSWORD=superadmin
COOKIE_SECRET=your-secure-cookie-secret
```

## Vendure Configuration

Configure your Vendure server to use MinIO as the primary asset storage strategy:

```ts title="src/vendure-config.ts"
import { VendureConfig } from '@vendure/core';
// highlight-start
import { AssetServerPlugin, configureS3AssetStorage } from '@vendure/asset-server-plugin';
// highlight-end
import 'dotenv/config';
import path from 'path';

const IS_DEV = process.env.APP_ENV === 'dev';
const serverPort = +(process.env.PORT || 3000);

// highlight-start
// MinIO Configuration (Primary Storage)
const useLocalFallback = process.env.ENABLE_LOCAL_FALLBACK === 'true';
const minioConfig = {
  endpoint: process.env.MINIO_ENDPOINT || 'http://localhost:9000',
  accessKey: process.env.MINIO_ACCESS_KEY || 'minioadmin',
  secretKey: process.env.MINIO_SECRET_KEY || 'minioadmin',
  bucket: process.env.MINIO_BUCKET || 'vendure-assets',
  region: process.env.MINIO_REGION || 'us-east-1',
};
// highlight-end

export const config: VendureConfig = {
  // ... other configuration options
  plugins: [
    // highlight-start
    AssetServerPlugin.init({
      route: 'assets',
      assetUploadDir: path.join(__dirname, '../static/assets'),
      // MinIO S3-compatible storage strategy (primary)
      storageStrategyFactory: useLocalFallback
        ? undefined // Falls back to local storage for development/testing
        : configureS3AssetStorage({
            bucket: minioConfig.bucket,
            credentials: {
              accessKeyId: minioConfig.accessKey,
              secretAccessKey: minioConfig.secretKey,
            },
            nativeS3Configuration: {
              endpoint: minioConfig.endpoint,
              forcePathStyle: true, // Required for MinIO
              signatureVersion: 'v4',
              region: minioConfig.region, // Required by AWS SDK
            },
          }),
      // Dynamic asset URL prefix based on storage strategy
      assetUrlPrefix: useLocalFallback
        ? IS_DEV ? undefined : 'https://www.my-shop.com/assets/'
        : `${minioConfig.endpoint}/${minioConfig.bucket}/`,
    }),
    // highlight-end
    // ... other plugins
  ],
};
```

### Key Configuration Options

- **`forcePathStyle: true`**: Required for MinIO compatibility. Uses path-style URLs instead of virtual-hosted style
- **`signatureVersion: 'v4'`**: Modern AWS signature version for enhanced security
- **`region`**: Required by AWS SDK even when using MinIO (can be any valid region)
- **`assetUrlPrefix`**: Configures direct MinIO URLs for optimal performance

## Testing the Integration

### 1. Start Your Services

```bash
# Start MinIO (if not already running)
docker start vendure-minio

# Start Vendure server
npm run dev
```

### 2. Upload Test Assets

1. Navigate to the Vendure Admin UI at `http://localhost:3000/admin`
2. Login with your superadmin credentials
3. Go to "Catalog" → "Products" 
4. Create a new product or edit an existing one
5. Upload product images using the asset picker

### 3. Verify MinIO Storage

1. Access MinIO Console at `http://localhost:9090`
2. Browse to your `vendure-assets` bucket
3. Confirm uploaded files are present with proper subdirectory structure (e.g., `a1/product-image.jpg`)

### 4. Test Asset Access

Copy an asset URL from the Admin UI and verify it loads in your browser. The URL should follow this pattern:
```
http://localhost:9000/vendure-assets/a1/your-asset-file.jpg
```

## Advanced Configuration

### Production Environment Variables

For production deployments, use secure credentials and HTTPS endpoints:

```bash title=".env.production"
MINIO_ENDPOINT=https://your-minio-server.com
MINIO_ACCESS_KEY=your-production-access-key-here
MINIO_SECRET_KEY=your-secure-production-secret-key
MINIO_BUCKET=vendure-production-assets
MINIO_REGION=us-west-2
ENABLE_LOCAL_FALLBACK=false
```

### CDN Integration

For enhanced performance, configure a CDN in front of MinIO:

```ts title="src/vendure-config.ts"
// Use CDN URL for production asset delivery
assetUrlPrefix: process.env.CDN_URL 
  ? `${process.env.CDN_URL}/assets/`
  : `${minioConfig.endpoint}/${minioConfig.bucket}/`,
```

### Multiple Environments

Use environment-specific bucket names to isolate assets:

```bash
# Development
MINIO_BUCKET=vendure-dev-assets

# Staging
MINIO_BUCKET=vendure-staging-assets

# Production
MINIO_BUCKET=vendure-prod-assets
```

## Troubleshooting

### Common Issues

**403 Forbidden Errors on Asset URLs**
- Ensure bucket has public read policy configured
- Verify MinIO console shows "Anonymous: Enabled" for the bucket
- Check bucket name matches environment configuration

**Connection Refused**
```bash
# Verify MinIO is running
docker ps | grep minio

# Check MinIO health
curl http://localhost:9000/minio/health/ready
```

**Assets Not Uploading**
- Confirm AWS SDK packages are installed: `@aws-sdk/client-s3` and `@aws-sdk/lib-storage`
- Check Vendure server logs for S3 connection errors
- Verify MinIO credentials and endpoint configuration

**Development vs Production Issues**
- Ensure `ENABLE_LOCAL_FALLBACK=false` in production
- Verify production MinIO endpoint is accessible from your server
- Check firewall rules and network configuration

### Performance Optimization

**Connection Pooling**
Configure connection limits in `nativeS3Configuration`:

```ts
nativeS3Configuration: {
  // ... other options
  maxSockets: 50,
  keepAlive: true,
  keepAliveMsecs: 1000,
}
```

**Multipart Upload Configuration**
For large file uploads, configure multipart settings:

```ts
nativeS3UploadConfiguration: {
  partSize: 5 * 1024 * 1024, // 5MB parts
  queueSize: 4, // Parallel uploads
}
```

## Migration from Local Storage

If you're migrating from local file storage:

### 1. Backup Existing Assets
```bash
tar -czf assets-backup.tar.gz static/assets/
```

### 2. Upload to MinIO
Using MinIO client (`mc`):
```bash
# Configure MinIO client
mc alias set myminio http://localhost:9000 minioadmin minioadmin

# Upload assets
mc cp --recursive static/assets/ myminio/vendure-assets/
```

### 3. Update Configuration
Switch from local to MinIO storage by updating environment variables and restarting your server.

## Summary

Your Vendure application now uses MinIO for scalable asset storage. Assets uploaded through the Admin UI are stored in MinIO and served directly to users, providing better performance and eliminating local storage limitations. Use the `ENABLE_LOCAL_FALLBACK` environment variable to quickly switch between storage strategies during development and testing.